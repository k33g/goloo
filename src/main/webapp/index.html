<!DOCTYPE html>
<html>
<head>
    <title>GolOO</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
    <style>
        body {
            position: relative;
            padding-top: 70px; /* fixed navbar */
        }
    </style>
<body>

    <div class="navbar navbar-inverse navbar-fixed-top" style="background-color: #357ebd;">
        <span class="navbar-brand" style="color: #ffffff;">GolOO ?</span>
        <ul class="nav navbar-nav">
            <li><a style="color: #ffffff;" href="#">minimalistic golo web framework for Google App Engine Java</a></li>
            <!--<li><a style="color: #ffffff;" href="#">somewhere ...</a></li>-->
        </ul>

    </div>

    <div class="container">

        <blockquote>
            <p>Why <b>GolOO</b> ? Because it reminds me of <b>Golu</b> (Corsica translation of <b>Golo</b>)</p>
        </blockquote>

        <div class="panel">
            <div class="panel-heading">
                <h3 class="panel-title">Technical stack</h3>
            </div>
            <ul>
                <li>Java
                    <ul>
                        <li>Golo</li>
                        <li>Jackson</li>
                    </ul>
                </li>
                <li>Javascript
                    <ul>
                        <li>Backbone</li>
                        <li>Underscore</li>
                        <li>jQuery</li>
                        <li>YepNope</li>
                    </ul>
                </li>
                <li>HTML / CSS
                    <ul>
                        <li>Bootstrap 3</li>
                    </ul>
                </li>
            </ul>
        </div>

        <div class="panel">
            <div class="panel-heading">
                <h3 class="panel-title">Source code</h3>
            </div>
            <a href="https://github.com/k33g/goloo">https://github.com/k33g/goloo</a>
        </div>

        <div class="panel panel-primary">
            <div class="panel-heading">
                <h3 class="panel-title">Routes</h3>
            </div>
            <pre><code>
match {
    when http:GET("/humans")            then humans():getAll(http)
    when http:GET("/humans/:var")       then humans():fetch(http)
    when http:POST("/humans")           then humans():insert(http)
    when http:PUT("/humans/:var")       then humans():update(http)
    when http:DELETE("/humans/:var")    then humans():delete(http)
    otherwise http:writeToJson( map[["message","404!"]] )
}
            </code></pre>
        </div>

        <div class="panel panel-primary">
            <div class="panel-heading">
                <h3 class="panel-title">Controllers</h3>
            </div>
            <pre><code>
function humans = -> DynamicObject()
    :getAll(|this, http| { # GET:/humans

        let humans = Store():query("human", 10)
        let humansArray = list[]
        humans:each(|human| {
            println(human:getProperty("firstName")+" "+human:getProperty("lastName"))
            humansArray:add(human:getProperties())
        })

        http:writeToJson(humansArray)
    })
    :insert(|this, http| { # POST:/humans

        let h = http:dataToMap()

        println(h:get("firstName"))
        println(h:get("lastName"))

        let datastore = Store()

        let human = datastore:entity("human")

        human:setProperty("firstName", h:get("firstName"))
        human:setProperty("lastName", h:get("lastName"))
        human:setProperty("when", java.util.Date())

        datastore:put(human)

        http:writeToJson(human:getProperties())
    })
    :fetch(|this, http| { # GET:/humans/:id

        let id = http:parameters():get(0)

        let human = Store():getById("human", id)

        http:writeToJson(human:getProperties())
    })
    :update(|this, http| { # PUT:/humans/:id

        let id = http:parameters():get(0)
        let h = http:dataToMap()

        let datastore = Store()

        let human = datastore:getById("human", id)

        human:setProperty("firstName", h:get("firstName"))
        human:setProperty("lastName", h:get("lastName"))
        human:setProperty("when", java.util.Date())

        datastore:put(human)

        http:writeToJson(human:getProperties())
    })
    :delete(|this, http| { # DELETE:/humans/:id

        # delete only if admin

        secure():admin({ # if current logged user is admin
            let id = http:parameters():get(0)
            let datastore = Store()
            let human = datastore:getById("human", id)
            datastore:delete(human)
            human:setProperty("deleted", true)
            http:writeToJson(human:getProperties())
        },{ # if current logged user isn't admin
            http:writeToJson( map[["message","Don't even think about this!"]] )
        })
    })
            </code></pre>
        </div>

        <div class="panel panel-primary">
            <div class="panel-heading">
                <h3 class="panel-title">Client</h3>
            </div>
            <pre><code>
//GET requests
$.ajax({
      type:"GET"
    , url:"/humans"
    , success:function(data){console.log(data)}
})

$.ajax({
      type:"GET"
    , url:"/humans/2caf0061-7229-4f8b-a457-84fee398f9a1"
    , success:function(data){console.log(data)}
})

//POST request
$.ajax({
      type:"POST"
    , url:"/humans"
    , data:'{"firstName":"John", "lastName":"Doe"}'
    , success:function(data){console.log(data)}
})

//PUT request
$.ajax({
      type:"PUT"
    , url:"/humans/23676a78-88e0-4a53-94b7-27782fe3537b"
    , data:'{"firstName":"DARIO", "lastName":"MORENO"}'
    , success:function(data){console.log(data)}
})

//DELETE request
$.ajax({
      type:"DELETE"
    , url:"/humans/2caf0061-7229-4f8b-a457-84fee398f9a1"
    , success:function(data){console.log(data)}
})
            </code></pre>
        </div>

    </div>

    <script src="js/vendors/yepnope.1.5.4-min.js"></script>

    <script>

        yepnope({
            load : [
                "bootstrap3/css/bootstrap.min.css",
                "js/vendors/jquery-1.9.1.min.js",
                "bootstrap3/js/bootstrap.min.js"
            ],
            complete : function() {
                console.log("All scripts loaded, starting application")
            }
        })

    </script>
</body>
</html>
